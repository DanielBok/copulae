import numpy as np
from numpy.testing import assert_array_almost_equal
import pytest
from copulae.special.debye import debye_n

VALUES = [-1, 0, 2.5, 3.5, 4, 6.7, 15.8, 36, 104.5, 551.3, 702.6, 1025.6, 6712.4, 10251.2]


@pytest.mark.parametrize('order, expected', [
    (1, [np.nan,
         1,
         0.538789569077856,
         0.430624598125269,
         0.388148021297938,
         0.244097102433199,
         0.104109604916145,
         0.0456926129680061,
         0.015740995855007,
         0.00298373674378419,
         0.00234120988734447,
         0.00160387487017183,
         0.000245059005251211,
         0.00016046258651165
         ]),
    (2, [np.nan,
         1,
         0.410794135797497,
         0.286509626630673,
         0.240553687521279,
         0.103803191576259,
         0.0192603338788639,
         0.00371005217024517,
         0.000440303803725957,
         1.58200930368215e-05,
         9.74021912478141e-06,
         4.57118706191541e-06,
         1.06715956352981e-07,
         4.57546886987235e-08],
     ),
    (3, [np.nan,
         1,
         0.354136034810424,
         0.226911291863489,
         0.181736913821775,
         0.0588583470970734,
         0.00493871716448086,
         0.000417562975968046,
         1.70718511354344e-05,
         1.1626942079575e-07,
         5.61700809899182e-08,
         1.80590728490782e-08,
         6.4416333292702e-11,
         1.80844525542437e-11]
     ),
    (4, [np.nan,
         1,
         0.322954348587073,
         0.195750888589831,
         0.15185461258672,
         0.0397642339847517,
         0.00159659901600611,
         5.92665612211462e-05,
         8.34746430299635e-07,
         1.07762525877332e-09,
         4.08495381287629e-10,
         8.99720640210334e-11,
         4.90352526620911e-14,
         9.01406957230595e-15]
     )
])
@pytest.mark.filterwarnings()
def test_debye(order, expected):
    res = debye_n(VALUES, order)
    assert_array_almost_equal(res, expected, 5)
